# ELT Log Search

This project performs an end-to-end ETL (Extract, Transform, Load) pipeline to analyze user search behavior based on log files stored in Parquet format and maps search keywords to categories.

## Project Overview

Project to create an OLAP output with analytics-ready views. The project involved:
- Extracts user search logs from multiple Parquet files
- Filters and transforms data to isolate meaningful user interactions
- Identifies the most searched keyword per user per month (June & July)
- Joins with keyword-category mappings
- Compares category changes between June and July

Please see [/writeup.md](./writeup.md) for an overview of the development process and [/etl-log-search.ipynb](./etl-log-search.ipynb) for an exploratory Jupyter notebook.

## Instructions

1. **Prerequisites**
- Python 3.8+
- Java 17/21 (for PySpark)
- Install required packages:
```
pip install pandas openpyxl pyspark
```
2. **Run the Pipeline**
```
python etl_log_search.py
```
This will:
- Load Parquet logs from `data/`
- Analyze search trends for June and July
- Map keywords to categories
- Compare changes in user preferences
Save the result to `output/` folder in CSV format

3. **Optional: Use n8n for Auto Mapping**
- Import `category-mapping.json` into your local n8n instance
- Connect it to your OpenAI API credentials and Google credentials
- Use the manual trigger to fetch the keywords
- Use the chat trigger to classify new search keywords
- Results will be appended to your Google Sheet

# Folder Structure

- `etl-log-search.ipynb`: Jupyter Notebook containing the discovery phase of this project: loading, inspecting, transforming
- `etl-log-search.py`: Python script implementing the ETL pipeline for log analysis using PySpark
- `mapping-keywords-with-category.xlsx`: Excel file mapping keywords to their respective categories
- `pie-chart.pdf`: A visual report showing distribution of category changes between June and July
- `category-mapping.json`: Template workflow file for n8n, designed to automate the category mapping of user search keywords using an LLM

### `data`
- `20220601`: contains Parquet log files for early June
- `20220714`: contains Parquet log files for mid July
    - each file represents a snapshot of user search logs

### `output`
- Output folder containing result files generated by the pipeline
  - CSV files with most searched keywords and category comparisons
  - Log file for logging of errors encountered during the python script execution